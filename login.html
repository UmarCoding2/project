<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Log in — Umar Spotify</title>
    <link rel="stylesheet" href="style.css">
    <style>
        :root {
            --card-bg: #ffffff;
            --accent: #6C63FF
        }

        body {
            background: linear-gradient(135deg, #0f1724 0%, #1f2937 60%);
            font-family: Inter, system-ui, Arial;
            color: #e6eef8
        }

        .auth-wrap {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 32px
        }

        .auth-card {
            width: 100%;
            max-width: 420px;
            background: var(--card-bg);
            border-radius: 14px;
            padding: 28px;
            box-shadow: 0 8px 30px rgba(2, 6, 23, 0.6);
            color: #0b1220
        }

        .brand {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 18px
        }

        .brand .logo {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--accent), #00c6ff);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 700
        }

        h1 {
            font-size: 20px;
            margin-bottom: 4px
        }

        p.lead {
            color: #475569;
            margin-bottom: 18px
        }

        .form-group {
            margin-bottom: 12px
        }

        label {
            display: block;
            font-size: 13px;
            color: #334155;
            margin-bottom: 6px
        }

        input[type="text"],
        input[type="email"],
        input[type="password"] {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #e6eef8;
            background: #fbfdff
        }

        .muted {
            font-size: 13px;
            color: #64748b
        }

        .btn-primary {
            display: inline-block;
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            background: var(--accent);
            color: #fff;
            border: none;
            font-weight: 600;
            cursor: pointer
        }

        .row {
            display: flex;
            gap: 8px
        }

        .helper {
            margin-top: 8px;
            font-size: 13px;
            color: #475569
        }

        .error {
            color: #b91c1c;
            font-size: 13px;
            margin-top: 8px
        }

        .success {
            color: #0f5132;
            font-size: 13px;
            margin-top: 8px
        }

        .switch-link {
            display: block;
            margin-top: 12px;
            text-align: center;
            color: var(--accent);
            text-decoration: none;
            font-weight: 600
        }

        .alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 13px
        }

        .alert.info {
            background: #dbeafe;
            color: #1e40af
        }
    </style>
</head>

<body>
    <div class="auth-wrap">
        <div class="auth-card" role="main">
            <div class="brand">
                <div class="logo">US</div>
                <div>
                    <h1>Welcome back</h1>
                    <p class="lead">Log in to your account and enjoy your music</p>
                </div>
            </div>

            <div id="createdAlert" class="alert info" style="display:none">
                ✓ Account created! Log in with your email and password.
            </div>

            <form id="loginForm" novalidate>
                <div class="form-group">
                    <label for="li-email">Email</label>
                    <input id="li-email" name="email" type="email" required aria-required="true">
                </div>
                <div class="form-group">
                    <label for="li-password">Password</label>
                    <input id="li-password" name="password" type="password" required aria-required="true">
                </div>

                <button type="submit" class="btn-primary">Log in</button>
                <div id="loginMessage" class="helper" aria-live="polite"></div>
            </form>

            <a href="signup.html" class="switch-link">Don't have an account? Sign up</a>
        </div>
    </div>

    <script>
        // Demo auth: verify email + SHA-256 hashed password
        async function hashPassword(pw) {
            const enc = new TextEncoder().encode(pw);
            const buf = await crypto.subtle.digest('SHA-256', enc);
            return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        function loadUsers() {
            try { return JSON.parse(localStorage.getItem('uwp_users') || '[]') } catch (e) { return [] }
        }

        // Show "account created" alert if redirected from signup
        if (new URLSearchParams(location.search).get('created') === '1') {
            document.getElementById('createdAlert').style.display = 'block';
        }

        document.getElementById('loginForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const email = document.getElementById('li-email').value.trim().toLowerCase();
            const password = document.getElementById('li-password').value;
            const msg = document.getElementById('loginMessage'); msg.textContent = ''; msg.className = 'helper';

            if (!email || !password) { msg.textContent = 'Please fill all fields.'; msg.className = 'error'; return }

            const users = loadUsers();
            const user = users.find(u => u.email === email);
            if (!user) { msg.textContent = 'Email not found. Please sign up first.'; msg.className = 'error'; return }

            const hash = await hashPassword(password);
            if (user.passwordHash !== hash) { msg.textContent = 'Incorrect password.'; msg.className = 'error'; return }

            // Successful login — set session
            localStorage.setItem('uwp_session', JSON.stringify({ email, username: user.username, loginTime: new Date().toISOString() }));
            msg.textContent = 'Login successful. Redirecting...'; msg.className = 'success';
            setTimeout(() => { location.href = 'index.html' }, 800);
        });
    </script>
</body>

</html>